System.register(["jimu-core","jimu-ui","esri/geometry"],(function(e,t){var r={},o={},a={};return Object.defineProperty(r,"__esModule",{value:!0}),Object.defineProperty(a,"__esModule",{value:!0}),{setters:[function(e){Object.keys(e).forEach((function(t){r[t]=e[t]}))},function(e){o.Loading=e.Loading},function(e){Object.keys(e).forEach((function(t){a[t]=e[t]}))}],execute:function(){e((()=>{var e={244:e=>{"use strict";e.exports=r},321:e=>{"use strict";e.exports=o},435:e=>{"use strict";if(void 0===a){var t=new Error("Cannot find module 'esri/geometry'");throw t.code="MODULE_NOT_FOUND",t}e.exports=a}},t={};function n(r){var o=t[r];if(void 0!==o)return o.exports;var a=t[r]={exports:{}};return e[r](a,a.exports,n),a.exports}n.d=(e,t)=>{for(var r in t)n.o(t,r)&&!n.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},n.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),n.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.p="";var i={};return n.p=window.jimuConfig.baseUrl,(()=>{"use strict";n.r(i),n.d(i,{__set_webpack_public_path__:()=>a,default:()=>o});var e=n(244),t=n(321),r=function(e,t,r,o){return new(r||(r=Promise))((function(a,n){function i(e){try{d(o.next(e))}catch(e){n(e)}}function s(e){try{d(o.throw(e))}catch(e){n(e)}}function d(e){var t;e.done?a(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(i,s)}d((o=o.apply(e,t||[])).next())}))};class o extends e.React.PureComponent{constructor(t){super(t),this.subscribeToFeatureSelection=()=>r(this,void 0,void 0,(function*(){try{const{MessageManager:e}=yield Promise.resolve().then(n.bind(n,244)),t=e.getInstance();if("function"==typeof t.subscribe)return t.subscribe({type:"FEATURE_SELECTED",callback:e=>{e.data&&e.data.feature&&(console.log("Layer Panel: Received FEATURE_SELECTED message",e.data.feature),this.queryLayersForFeature(e.data.feature))}}),void console.log("Layer Panel: Subscribed using subscribe() method");if("function"==typeof t.on)return t.on("FEATURE_SELECTED",(e=>{e&&e.data&&e.data.feature&&(console.log("Layer Panel: Received FEATURE_SELECTED message",e.data.feature),this.queryLayersForFeature(e.data.feature))})),void console.log("Layer Panel: Subscribed using on() method");if("function"==typeof t.addListener)return t.addListener("FEATURE_SELECTED",(e=>{e&&e.data&&e.data.feature&&(console.log("Layer Panel: Received FEATURE_SELECTED message",e.data.feature),this.queryLayersForFeature(e.data.feature))})),void console.log("Layer Panel: Subscribed using addListener() method");const r=e=>{e.detail&&"FEATURE_SELECTED"===e.detail.type&&e.detail.data&&e.detail.data.feature&&(console.log("Layer Panel: Received FEATURE_SELECTED via custom event",e.detail.data.feature),this.queryLayersForFeature(e.detail.data.feature))};window.addEventListener("jimu-message",r),console.log("Layer Panel: Subscribed using custom event listener"),this._messageHandler=r}catch(e){console.error("Layer Panel: Error subscribing to messages:",e),console.error("Layer Panel: MessageManager methods:",Object.keys(messageManager||{}));const t=e=>{e.detail&&"FEATURE_SELECTED"===e.detail.type&&e.detail.data&&e.detail.data.feature&&(console.log("Layer Panel: Received FEATURE_SELECTED via custom event (fallback)",e.detail.data.feature),this.queryLayersForFeature(e.detail.data.feature))};window.addEventListener("jimu-message",t),this._messageHandler=t,console.log("Layer Panel: Using custom event listener as fallback")}})),this.queryLayersForFeature=e=>r(this,void 0,void 0,(function*(){var t;try{if(this.setState({loading:!0,error:null}),!e.geometry)return console.warn("Layer Panel: No geometry available for feature"),void this.setState({containingLayers:[],selectedFeature:null,loading:!1});const o=null===(t=this.props.config)||void 0===t?void 0:t.mapWidgetId;if(!o)return console.warn("Layer Panel: No map widget configured"),void this.setState({error:"No map widget configured. Please configure the map widget ID in widget settings.",loading:!1});const a=document.getElementById(o);if(!a)return console.warn("Layer Panel: Map widget element not found"),void this.setState({error:"Map widget not found. Please ensure the map widget is added to the experience.",loading:!1});const i=(e,t=0)=>{if(t>5)return null;if(e&&"object"==typeof e){if("function"==typeof e.goTo&&e.center&&void 0!==e.zoom)return e;for(const r in e)try{const o=e[r];if(o&&"object"==typeof o){const e=i(o,t+1);if(e)return e}}catch(e){}}return null},s=Object.keys(a).find((e=>e.startsWith("__react")));if(!s)return console.warn("Layer Panel: Could not find React fiber"),void this.setState({error:"Could not access map view. Map may not be ready.",loading:!1});const d=a[s],l=i(d);if(!l||!l.map)return console.warn("Layer Panel: Could not find map view"),void this.setState({error:"Could not access map view. Map may not be ready.",loading:!1});const{Point:u,Polygon:c,Polyline:f}=yield Promise.resolve().then(n.bind(n,435));let p;const y=e.geometry;if("point"===y.type||void 0!==y.x&&void 0!==y.y)p=new u({x:y.x,y:y.y,spatialReference:y.spatialReference||{wkid:4326}});else if("polygon"===y.type)p=c.fromJSON(y);else if("polyline"===y.type)p=f.fromJSON(y);else try{if("string"==typeof y){const e=JSON.parse(y);p=u.fromJSON(e)}else p=u.fromJSON(y)}catch(e){p=new u({x:y.x||0,y:y.y||0,spatialReference:y.spatialReference||{wkid:4326}})}const g=[],x=(e,t)=>r(this,void 0,void 0,(function*(){try{if(!e.queryFeatures||"function"!=typeof e.queryFeatures)return;const r=e.createQuery();r.geometry=p,r.spatialRelationship="intersects",r.returnGeometry=!0,r.outFields=["*"];const o=yield e.queryFeatures(r);if(o.features&&o.features.length>0){const r={};e.fields&&Array.isArray(e.fields)&&e.fields.forEach((e=>{e.name&&e.alias&&(r[e.name]=e.alias)}));const a=[];if(e.popupTemplate){const t=e.popupTemplate;t.fieldInfos&&Array.isArray(t.fieldInfos)&&t.fieldInfos.forEach((e=>{e.fieldName&&a.push(e.fieldName)})),t.content&&Array.isArray(t.content)&&t.content.forEach((e=>{e.fieldInfos&&Array.isArray(e.fieldInfos)?e.fieldInfos.forEach((e=>{e.fieldName&&a.push(e.fieldName)})):e.fieldName&&a.push(e.fieldName)}))}g.push({layerName:e.title||e.name||"Unnamed Layer",layerId:e.id||e.url||"unknown",featureCount:o.features.length,features:o.features,layerIndex:t,fieldAliases:r,popupFieldNames:a.length>0?a:void 0})}}catch(t){console.warn(`Layer Panel: Error querying layer ${e.title||e.id}:`,t)}})),m=(e,...t)=>r(this,[e,...t],void 0,(function*(e,t=0){let r=t;const o=[...e].reverse();for(const e of o)yield x(e,r),r++,e.layers&&e.layers.length>0&&(yield m(e.layers,r))}));yield m(l.map.layers),g.sort(((e,t)=>e.layerIndex-t.layerIndex));const b={},h={};g.forEach((e=>{b[e.layerId]=!1,h[e.layerId]=0})),this.setState({selectedFeature:e,containingLayers:g,loading:!1,expandedLayers:b,currentFeatureIndex:h}),console.log(`Layer Panel: Found ${g.length} layers containing the selected feature`)}catch(e){console.error("Layer Panel: Error querying layers:",e),this.setState({error:"Failed to query layers. Please check the console for details.",containingLayers:[],selectedFeature:null,loading:!1})}})),this.toggleLayerExpansion=e=>{this.setState((t=>({expandedLayers:Object.assign(Object.assign({},t.expandedLayers),{[e]:!t.expandedLayers[e]})})))},this.navigateFeature=(e,t)=>{const r=this.state.containingLayers.find((t=>t.layerId===e));r&&this.setState((o=>{const a=o.currentFeatureIndex[e]||0;let n=a;return n="next"===t?(a+1)%r.features.length:0===a?r.features.length-1:a-1,{currentFeatureIndex:Object.assign(Object.assign({},o.currentFeatureIndex),{[e]:n})}}))},this.state={selectedFeature:null,containingLayers:[],loading:!1,error:null,expandedLayers:{},currentFeatureIndex:{}},this.widgetRef=e.React.createRef()}componentDidMount(){this.subscribeToFeatureSelection()}componentWillUnmount(){this._messageHandler&&window.removeEventListener("jimu-message",this._messageHandler)}render(){const{containingLayers:r,selectedFeature:o,loading:a,error:n,expandedLayers:i,currentFeatureIndex:s}=this.state;return(0,e.jsx)("div",{ref:this.widgetRef,className:"layer-panel-widget",style:{position:"relative",width:"100%",height:"100%",display:"flex",flexDirection:"column",backgroundColor:"#fff"}},n&&(0,e.jsx)("div",{style:{padding:"8px",backgroundColor:"#fee",color:"#c00",fontSize:"12px",marginBottom:"4px",borderRadius:"4px"}},"Error: ",n),(0,e.jsx)("div",{style:{padding:"12px",borderBottom:"1px solid #eee",backgroundColor:"#f8f9fa",fontWeight:"bold",fontSize:"16px"}},"Containing Layers"),(0,e.jsx)("div",{style:{flex:1,overflowY:"auto",padding:"12px"}},a?(0,e.jsx)("div",{style:{padding:"20px",textAlign:"center"}},(0,e.jsx)(t.Loading,null),(0,e.jsx)("div",{style:{marginTop:"8px",fontSize:"12px",color:"#666"}},"Querying layers...")):o?0===r.length?(0,e.jsx)("div",{style:{padding:"20px",textAlign:"center",color:"#666"}},(0,e.jsx)("div",{style:{fontSize:"14px",marginBottom:"8px"}},"No layers contain this feature"),(0,e.jsx)("div",{style:{fontSize:"12px",color:"#999"}},"The selected feature does not intersect any features in the map layers")):(0,e.jsx)("div",null,o&&(0,e.jsx)("div",{style:{padding:"12px",marginBottom:"12px",backgroundColor:"#e7f3ff",borderRadius:"4px",border:"1px solid #b3d9ff"}},(0,e.jsx)("div",{style:{fontWeight:"bold",marginBottom:"8px",fontSize:"14px"}},"Selected Project:"),(0,e.jsx)("div",{style:{fontSize:"12px"}},["project_name","project_id","state_of_project","general_description","multiple_phases","video_fly_through","project_5_mile","timeframe","special_requests","submitted_by","submitted_by_email"].map((t=>{const r=o.attributes[t],a=t.replace(/_/g," ").replace(/\b\w/g,(e=>e.toUpperCase()));return(0,e.jsx)("div",{key:t,style:{marginBottom:"6px",padding:"4px",backgroundColor:"#fff",borderRadius:"2px"}},(0,e.jsx)("strong",null,a,":")," ",String(r||"N/A"))})))),r.filter((e=>{const t=e.layerName.toLowerCase();return!(t.includes("drone")&&t.includes("marketing"))})).map(((t,r)=>{const o=i[t.layerId]||!1,a=s[t.layerId]||0,n=t.features[a],d=t.layerName.toLowerCase().includes("prohibited areas"),l="rgba(255, 0, 0, 0.3)";return(0,e.jsx)("div",{key:t.layerId,style:{marginBottom:"8px",border:d?"1px solid rgba(255, 0, 0, 0.5)":"1px solid #ddd",borderRadius:"4px",backgroundColor:d?l:"#fff",overflow:"hidden"}},(0,e.jsx)("div",{onClick:()=>this.toggleLayerExpansion(t.layerId),style:{padding:"12px",cursor:"pointer",display:"flex",justifyContent:"space-between",alignItems:"center",backgroundColor:d?o?"rgba(255, 0, 0, 0.4)":l:o?"#f0f0f0":"#fff",transition:"background-color 0.2s"}},(0,e.jsx)("div",{style:{flex:1}},(0,e.jsx)("div",{style:{fontWeight:"bold",marginBottom:"4px",fontSize:"15px"}},t.layerName),(0,e.jsx)("div",{style:{fontSize:"14px",color:"#666"}},t.featureCount," feature",1!==t.featureCount?"s":""," found")),(0,e.jsx)("div",{style:{fontSize:"18px",color:"#666",transform:o?"rotate(180deg)":"rotate(0deg)",transition:"transform 0.2s"}},"\u25bc")),o&&n&&(0,e.jsx)("div",{style:{padding:"12px",borderTop:"1px solid #eee",backgroundColor:d?l:"#fafafa"}},t.features.length>1&&(0,e.jsx)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"12px",padding:"8px",backgroundColor:"#fff",borderRadius:"4px",border:"1px solid #ddd"}},(0,e.jsx)("button",{onClick:e=>{e.stopPropagation(),this.navigateFeature(t.layerId,"prev")},style:{padding:"4px 12px",backgroundColor:"#007bff",color:"#fff",border:"none",borderRadius:"4px",cursor:"pointer",fontSize:"14px"}},"\u2190 Prev"),(0,e.jsx)("div",{style:{fontSize:"14px",fontWeight:"bold"}},"Feature ",a+1," of ",t.features.length),(0,e.jsx)("button",{onClick:e=>{e.stopPropagation(),this.navigateFeature(t.layerId,"next")},style:{padding:"4px 12px",backgroundColor:"#007bff",color:"#fff",border:"none",borderRadius:"4px",cursor:"pointer",fontSize:"14px"}},"Next \u2192")),(0,e.jsx)("div",{style:{backgroundColor:"#fff",padding:"12px",borderRadius:"4px",border:"1px solid #ddd"}},(0,e.jsx)("div",{style:{fontWeight:"bold",marginBottom:"8px",fontSize:"14px"}},"Feature Details:"),n.attributes&&(0,e.jsx)("div",{style:{fontSize:"12px"}},Object.entries(n.attributes).filter((([e])=>!(t.popupFieldNames&&t.popupFieldNames.length>0)||t.popupFieldNames.includes(e))).map((([r,o])=>{const a=t.fieldAliases&&t.fieldAliases[r]?t.fieldAliases[r]:r;return(0,e.jsx)("div",{key:r,style:{marginBottom:"6px",padding:"4px",backgroundColor:"#f8f9fa",borderRadius:"2px"}},(0,e.jsx)("strong",null,a,":")," ",String(o||"N/A"))}))))))}))):(0,e.jsx)("div",{style:{padding:"20px",textAlign:"center",color:"#666"}},(0,e.jsx)("div",{style:{fontSize:"14px",marginBottom:"8px"}},"Select a project from the Notification Center to see Airspace Details"),(0,e.jsx)("div",{style:{fontSize:"12px",color:"#999"}}))))}}function a(e){n.p=e}})(),i})())}}}));