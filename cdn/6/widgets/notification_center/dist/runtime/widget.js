System.register(["jimu-core","jimu-ui","esri/geometry"],(function(e,t){var o={},r={},s={};return Object.defineProperty(o,"__esModule",{value:!0}),Object.defineProperty(s,"__esModule",{value:!0}),{setters:[function(e){Object.keys(e).forEach((function(t){o[t]=e[t]}))},function(e){r.Button=e.Button,r.Loading=e.Loading},function(e){Object.keys(e).forEach((function(t){s[t]=e[t]}))}],execute:function(){e((()=>{var e={244:e=>{"use strict";e.exports=o},321:e=>{"use strict";e.exports=r},435:e=>{"use strict";if(void 0===s){var t=new Error("Cannot find module 'esri/geometry'");throw t.code="MODULE_NOT_FOUND",t}e.exports=s}},t={};function n(o){var r=t[o];if(void 0!==r)return r.exports;var s=t[o]={exports:{}};return e[o](s,s.exports,n),s.exports}n.d=(e,t)=>{for(var o in t)n.o(t,o)&&!n.o(e,o)&&Object.defineProperty(e,o,{enumerable:!0,get:t[o]})},n.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),n.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.p="";var i={};return n.p=window.jimuConfig.baseUrl,(()=>{"use strict";n.r(i),n.d(i,{__set_webpack_public_path__:()=>s,default:()=>r});var e=n(244),t=n(321),o=function(e,t,o,r){return new(o||(o=Promise))((function(s,n){function i(e){try{l(r.next(e))}catch(e){n(e)}}function a(e){try{l(r.throw(e))}catch(e){n(e)}}function l(e){var t;e.done?s(e.value):(t=e.value,t instanceof o?t:new o((function(e){e(t)}))).then(i,a)}l((r=r.apply(e,t||[])).next())}))};class r extends e.React.PureComponent{constructor(r){var s;super(r),this.subscribeToFeatureSelection=()=>o(this,void 0,void 0,(function*(){try{const{MessageManager:e}=yield Promise.resolve().then(n.bind(n,244));e.getInstance().subscribe({type:"FEATURE_SELECTED",callback:e=>{e.data&&e.data.feature&&this.queryLayersForFeature(e.data.feature)}}),console.log("Subscribed to FEATURE_SELECTED messages")}catch(e){console.error("Error subscribing to messages:",e)}})),this.getAuthToken=()=>{try{const t=(0,e.getAppStore)().getState(),o=t.user;if(o&&o.credential)return o.credential.token||null;if(t.portalSelf&&t.portalSelf.token)return t.portalSelf.token;if(t.portalUrl){const e=`arcgis_token_${t.portalUrl}`,o=localStorage.getItem(e)||sessionStorage.getItem(e);if(o)return o}try{for(let e=0;e<localStorage.length;e++){const t=localStorage.key(e);if(t&&(t.includes("token")||t.includes("credential"))){const e=localStorage.getItem(t);if(e&&e.length>20)try{const t=JSON.parse(e);if(t.token)return t.token}catch(t){if(e.startsWith("A")||e.length>50)return e}}}}catch(e){}return console.log("App store state keys:",Object.keys(t)),console.log("User object:",o),console.log("Portal self:",t.portalSelf),console.log("Portal URL:",t.portalUrl),null}catch(e){return console.error("Error getting auth token:",e),null}},this.loadData=()=>o(this,void 0,void 0,(function*(){this.setState({loading:!0,error:null});try{const[e,t,o]=yield Promise.all([this.queryBadgeCount(),this.queryNewRequests(),this.queryCompletedRequests()]);this.setState({badgeCount:e,newRequests:t,completedRequests:o,loading:!1})}catch(e){console.error("Error loading data:",e),this.setState({error:`Failed to load data: ${e.message}`,loading:!1})}})),this.queryBadgeCount=()=>o(this,void 0,void 0,(function*(){try{const e=encodeURIComponent("(reviewed = 0 OR reviewed IS NULL) AND (completed = 0 OR completed IS NULL)"),t=`${this.featureLayerUrl}/query?where=${e}&returnCountOnly=true&f=json`,o=yield fetch(t),r=yield o.json();if(console.log("Badge count query result:",r),r.error)throw new Error(r.error.message||"Query failed");return r.count||0}catch(e){console.error("Error querying badge count:",e);try{const e=encodeURIComponent("reviewed = 0 AND completed = 0"),t=`${this.featureLayerUrl}/query?where=${e}&returnCountOnly=true&f=json`,o=yield fetch(t),r=yield o.json();if(r.error)throw new Error(r.error.message||"Query failed");return r.count||0}catch(e){return console.error("Alternative badge count query also failed:",e),0}}})),this.queryNewRequests=()=>o(this,void 0,void 0,(function*(){var e;try{const t=encodeURIComponent("completed = 0 OR completed IS NULL"),o=`${this.featureLayerUrl}/query?where=${t}&orderByFields=CreationDate DESC&outFields=*&returnGeometry=true&f=json`,r=yield fetch(o),s=yield r.json();if(console.log("New requests query result:",s),console.log("New requests count:",(null===(e=s.features)||void 0===e?void 0:e.length)||0),s.error)throw new Error(s.error.message||"Query failed");return s.features||[]}catch(e){console.error("Error querying new requests:",e);try{const e=encodeURIComponent("completed = 0"),t=`${this.featureLayerUrl}/query?where=${e}&orderByFields=CreationDate DESC&outFields=*&returnGeometry=true&f=json`,o=yield fetch(t),r=yield o.json();if(r.error)throw new Error(r.error.message||"Query failed");return r.features||[]}catch(e){return console.error("Alternative new requests query also failed:",e),[]}}})),this.queryCompletedRequests=()=>o(this,void 0,void 0,(function*(){var e;try{const t=encodeURIComponent("completed = 1"),o=`${this.featureLayerUrl}/query?where=${t}&orderByFields=CreationDate DESC&outFields=*&returnGeometry=true&f=json`,r=yield fetch(o),s=yield r.json();if(console.log("Completed requests query result:",s),console.log("Completed requests count:",(null===(e=s.features)||void 0===e?void 0:e.length)||0),s.error)throw new Error(s.error.message||"Query failed");return s.features||[]}catch(e){console.error("Error querying completed requests:",e);try{const e=encodeURIComponent("completed = 1"),t=`${this.featureLayerUrl}/query?where=${e}&outFields=*&returnGeometry=true&f=json`,o=yield fetch(t),r=yield o.json();if(r.error)throw new Error(r.error.message||"Query failed");return r.features||[]}catch(e){return console.error("Alternative completed requests query also failed:",e),[]}}})),this.handleReviewed=e=>o(this,void 0,void 0,(function*(){const t=e.attributes.reviewed||0,o=e.attributes.objectid;if(!o)return void console.error("Missing objectId:",e);const r=0===t?1:0,s=1===r?(new Date).getTime():null;this.updateLocalStateForReviewed(e,r,s);try{const e=`${this.featureLayerUrl}/applyEdits`,t=[{attributes:{objectid:o,reviewed:r,reviewed_date:s}}];console.log("Sending reviewed update:",t);const n=new URLSearchParams;n.append("f","json"),n.append("updates",JSON.stringify(t));const i=this.getAuthToken();i?(n.append("token",i),console.log("Including authentication token")):console.warn("No authentication token available"),console.log("Request URL:",e),console.log("Request body:",n.toString());const a=yield fetch(e,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:n.toString()});if(console.log("Response status:",a.status),console.log("Response ok:",a.ok),!a.ok){const e=yield a.text();throw console.error("Response not OK. Status:",a.status,"Text:",e),new Error(`HTTP error! status: ${a.status}`)}const l=yield a.json();if(console.log("Reviewed update result:",JSON.stringify(l,null,2)),l.error)throw console.error("Update error:",l.error),new Error(l.error.message||"Update failed");if(l.updateResults&&l.updateResults.length>0){const e=l.updateResults[0];if(console.log("Update result:",e),e.error)throw console.error("Update result error:",e.error),new Error(e.error.description||e.error.message||"Update failed");if(!e.success)throw console.error("Update not successful:",e),new Error("Update was not successful")}const d=yield this.queryBadgeCount();this.setState({badgeCount:d})}catch(o){console.error("Error updating reviewed status:",o),console.error("Error stack:",o.stack),alert("Failed to update record. Please try again."),this.updateLocalStateForReviewed(e,t,e.attributes.reviewed_date)}})),this.updateLocalStateForReviewed=(e,t,o)=>{const r=Object.assign(Object.assign({},e),{attributes:Object.assign(Object.assign({},e.attributes),{reviewed:t,reviewed_date:o})});this.setState((t=>({newRequests:t.newRequests.map((t=>t.attributes.objectid===e.attributes.objectid?r:t))})))},this.handleMoveToComplete=e=>o(this,void 0,void 0,(function*(){const t=e.attributes.objectid;if(!t)return void console.error("Missing objectId:",e);this.setState((t=>({newRequests:t.newRequests.filter((t=>t.attributes.objectid!==e.attributes.objectid)),completedRequests:[Object.assign(Object.assign({},e),{attributes:Object.assign(Object.assign({},e.attributes),{completed:1,completed_date:(new Date).getTime()})}),...t.completedRequests]})));const o=this.state.badgeCount,r=Math.max(0,o-1);this.setState({badgeCount:r});try{const e=`${this.featureLayerUrl}/applyEdits`,o=[{attributes:{objectid:t,completed:1,completed_date:(new Date).getTime()}}];console.log("Sending move to complete update:",o);const r=new URLSearchParams;r.append("f","json"),r.append("updates",JSON.stringify(o));const s=this.getAuthToken();s?(r.append("token",s),console.log("Including authentication token")):console.warn("No authentication token available"),console.log("Request URL:",e),console.log("Request body:",r.toString());const n=yield fetch(e,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:r.toString()});if(console.log("Response status:",n.status),console.log("Response ok:",n.ok),!n.ok){const e=yield n.text();throw console.error("Response not OK. Status:",n.status,"Text:",e),new Error(`HTTP error! status: ${n.status}`)}const i=yield n.json();if(console.log("Move to complete update result:",JSON.stringify(i,null,2)),i.error)throw console.error("Update error:",i.error),new Error(i.error.message||"Update failed");if(i.updateResults&&i.updateResults.length>0){const e=i.updateResults[0];if(console.log("Update result:",e),e.error)throw console.error("Update result error:",e.error),new Error(e.error.description||e.error.message||"Update failed");if(!e.success)throw console.error("Update not successful:",e),new Error("Update was not successful")}const a=yield this.queryBadgeCount();this.setState({badgeCount:a})}catch(t){console.error("Error moving to complete:",t),console.error("Error stack:",t.stack),alert("Failed to update record. Please try again."),this.setState((t=>({newRequests:[e,...t.newRequests],completedRequests:t.completedRequests.filter((t=>t.attributes.objectid!==e.attributes.objectid)),badgeCount:o})))}})),this.handleMoveToOpen=e=>o(this,void 0,void 0,(function*(){const t=e.attributes.objectid;if(!t)return void console.error("Missing objectId:",e);this.setState((t=>{const o=t.completedRequests.filter((t=>t.attributes.objectid!==e.attributes.objectid));return{newRequests:[Object.assign(Object.assign({},e),{attributes:Object.assign(Object.assign({},e.attributes),{completed:0,completed_date:null})}),...t.newRequests],completedRequests:o}}));const o=this.state.badgeCount,r=0===e.attributes.reviewed||!e.attributes.reviewed?o+1:o;this.setState({badgeCount:r});try{const e=`${this.featureLayerUrl}/applyEdits`,o=[{attributes:{objectid:t,completed:0,completed_date:null}}];console.log("Sending move to open update:",o);const r=new URLSearchParams;r.append("f","json"),r.append("updates",JSON.stringify(o));const s=this.getAuthToken();s?(r.append("token",s),console.log("Including authentication token")):console.warn("No authentication token available"),console.log("Request URL:",e),console.log("Request body:",r.toString());const n=yield fetch(e,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:r.toString()});if(console.log("Response status:",n.status),console.log("Response ok:",n.ok),!n.ok){const e=yield n.text();throw console.error("Response not OK. Status:",n.status,"Text:",e),new Error(`HTTP error! status: ${n.status}`)}const i=yield n.json();if(console.log("Move to open update result:",JSON.stringify(i,null,2)),i.error)throw console.error("Update error:",i.error),new Error(i.error.message||"Update failed");if(i.updateResults&&i.updateResults.length>0){const e=i.updateResults[0];if(console.log("Update result:",e),e.error)throw console.error("Update result error:",e.error),new Error(e.error.description||e.error.message||"Update failed");if(!e.success)throw console.error("Update not successful:",e),new Error("Update was not successful")}const a=yield this.queryBadgeCount();this.setState({badgeCount:a})}catch(t){console.error("Error moving to open:",t),console.error("Error stack:",t.stack),alert("Failed to update record. Please try again."),this.setState((t=>{const r=[e,...t.completedRequests];return{newRequests:t.newRequests.filter((t=>t.attributes.objectid!==e.attributes.objectid)),completedRequests:r,badgeCount:o}}))}})),this.zoomToFeature=e=>o(this,void 0,void 0,(function*(){var t;try{if(!e.geometry)return void console.warn("No geometry available for feature:",e);const o=null===(t=this.props.config)||void 0===t?void 0:t.mapWidgetId;if(!o)return void console.warn("No map widget configured. Please select a map widget in the widget settings.");let r=e.geometry;void 0===r.x||void 0===r.y||r.type||(r={type:"point",x:r.x,y:r.y,spatialReference:e.geometry.spatialReference||{wkid:4326}});const{Point:s}=yield Promise.resolve().then(n.bind(n,435));let i;i="point"===r.type||void 0!==r.x&&void 0!==r.y?new s({x:r.x,y:r.y,spatialReference:r.spatialReference||{wkid:4326}}):new s({x:r.x||0,y:r.y||0,spatialReference:r.spatialReference||{wkid:4326}});try{const t=document.getElementById(o);if(t){const o=(e,t=0)=>{if(t>5)return null;if(e&&"object"==typeof e){if("function"==typeof e.goTo&&e.center&&void 0!==e.zoom)return e;for(const r in e)try{const s=e[r];if(s&&"object"==typeof s){const e=o(s,t+1);if(e)return e}}catch(e){}}return null},r=Object.keys(t).find((e=>e.startsWith("__react")));if(r){const s=t[r],n=o(s);if(n)return console.log("Found view through DOM search! Zooming..."),yield n.goTo({target:i,zoom:15}),console.log("Successfully zoomed using DOM view"),void(yield this.publishFeatureSelected(e))}}}catch(e){console.error("DOM view search failed:",e)}try{const{MessageManager:t}=yield Promise.resolve().then(n.bind(n,244));return t.getInstance().publishMessage({type:"RECORD_SELECTION_CHANGE",widgetId:o,data:{records:[{feature:{geometry:i,attributes:e.attributes}}]}}),console.log("Sent message to map widget (requires action configuration)"),void(yield this.publishFeatureSelected(e))}catch(e){console.error("MessageManager failed:",e)}yield this.publishFeatureSelected(e),console.warn("Could not zoom to feature. Map widget may not be ready.")}catch(e){console.error("Error zooming to feature:",e)}})),this.publishFeatureSelected=e=>o(this,void 0,void 0,(function*(){var t;try{if("notification"===((null===(t=this.props.config)||void 0===t?void 0:t.widgetMode)||"notification")){const{MessageManager:t}=yield Promise.resolve().then(n.bind(n,244)),o=t.getInstance(),r={type:"FEATURE_SELECTED",data:{feature:e}};"function"==typeof o.publishMessage&&(o.publishMessage(r),console.log("Published FEATURE_SELECTED message via publishMessage"));const s=new CustomEvent("jimu-message",{detail:r});window.dispatchEvent(s),console.log("Published FEATURE_SELECTED message via custom event")}}catch(t){console.error("Failed to publish FEATURE_SELECTED message:",t);try{const t=new CustomEvent("jimu-message",{detail:{type:"FEATURE_SELECTED",data:{feature:e}}});window.dispatchEvent(t),console.log("Published FEATURE_SELECTED message via custom event (fallback)")}catch(e){console.error("Failed to publish via custom event:",e)}}})),this.queryLayersForFeature=e=>o(this,void 0,void 0,(function*(){var t;try{if(!e.geometry)return console.warn("No geometry available for feature"),void this.setState({containingLayers:[],selectedFeature:null});const r=null===(t=this.props.config)||void 0===t?void 0:t.mapWidgetId;if(!r)return void console.warn("No map widget configured");const s=document.getElementById(r);if(!s)return void console.warn("Map widget element not found");const i=(e,t=0)=>{if(t>5)return null;if(e&&"object"==typeof e){if("function"==typeof e.goTo&&e.center&&void 0!==e.zoom)return e;for(const o in e)try{const r=e[o];if(r&&"object"==typeof r){const e=i(r,t+1);if(e)return e}}catch(e){}}return null},a=Object.keys(s).find((e=>e.startsWith("__react")));if(!a)return void console.warn("Could not find React fiber");const l=s[a],d=i(l);if(!d||!d.map)return void console.warn("Could not find map view");const{Point:c,Polygon:u,Polyline:p}=yield Promise.resolve().then(n.bind(n,435));let g;const f=e.geometry;if("point"===f.type||void 0!==f.x&&void 0!==f.y)g=new c({x:f.x,y:f.y,spatialReference:f.spatialReference||{wkid:4326}});else if("polygon"===f.type)g=u.fromJSON(f);else if("polyline"===f.type)g=p.fromJSON(f);else try{if("string"==typeof f){const e=JSON.parse(f);g=c.fromJSON(e)}else g=c.fromJSON(f)}catch(e){g=new c({x:f.x||0,y:f.y||0,spatialReference:f.spatialReference||{wkid:4326}})}const y=[],h=e=>o(this,void 0,void 0,(function*(){try{if(!e.queryFeatures||"function"!=typeof e.queryFeatures)return;const t=e.createQuery();t.geometry=g,t.spatialRelationship="intersects",t.returnGeometry=!0,t.outFields=["*"];const o=yield e.queryFeatures(t);o.features&&o.features.length>0&&y.push({layerName:e.title||e.name||"Unnamed Layer",layerId:e.id||e.url||"unknown",featureCount:o.features.length,features:o.features})}catch(t){console.warn(`Error querying layer ${e.title||e.id}:`,t)}})),m=e=>o(this,void 0,void 0,(function*(){for(const t of e)yield h(t),t.layers&&t.layers.length>0&&(yield m(t.layers))}));yield m(d.map.layers),this.setState({selectedFeature:e,containingLayers:y}),console.log(`Found ${y.length} layers containing the selected feature`)}catch(e){console.error("Error querying layers:",e),this.setState({error:"Failed to query layers",containingLayers:[],selectedFeature:null})}})),this.toggleDropdown=()=>{this.setState((e=>({isDropdownOpen:!e.isDropdownOpen})))},this.handleClickOutside=e=>{this.widgetRef.current&&!this.widgetRef.current.contains(e.target)&&this.setState({isDropdownOpen:!1})},this.renderLayersPanel=()=>{const{containingLayers:o,selectedFeature:r,loading:s,error:n}=this.state;return(0,e.jsx)("div",{ref:this.widgetRef,className:"notification-center-widget",style:{position:"relative",width:"100%",height:"100%",display:"flex",flexDirection:"column"}},n&&(0,e.jsx)("div",{style:{padding:"8px",backgroundColor:"#fee",color:"#c00",fontSize:"12px",marginBottom:"4px",borderRadius:"4px"}},"Error: ",n),(0,e.jsx)("div",{style:{padding:"12px",borderBottom:"1px solid #eee",backgroundColor:"#f8f9fa",fontWeight:"bold",fontSize:"16px"}},"Containing Layers"),(0,e.jsx)("div",{style:{flex:1,overflowY:"auto",padding:"12px"}},s?(0,e.jsx)("div",{style:{padding:"20px",textAlign:"center"}},(0,e.jsx)(t.Loading,null)):r?0===o.length?(0,e.jsx)("div",{style:{padding:"20px",textAlign:"center",color:"#666"}},"No layers contain this feature"):(0,e.jsx)("div",null,r&&(0,e.jsx)("div",{style:{padding:"12px",marginBottom:"12px",backgroundColor:"#e7f3ff",borderRadius:"4px",border:"1px solid #b3d9ff"}},(0,e.jsx)("div",{style:{fontWeight:"bold",marginBottom:"4px"}},"Selected Feature:"),(0,e.jsx)("div",{style:{fontSize:"14px"}},r.attributes.project_name||"N/A"),(0,e.jsx)("div",{style:{fontSize:"12px",color:"#666"}},"ID: ",r.attributes.project_id||"N/A")),o.map(((t,o)=>(0,e.jsx)("div",{key:o,style:{padding:"12px",marginBottom:"8px",border:"1px solid #ddd",borderRadius:"4px",backgroundColor:"#fff"}},(0,e.jsx)("div",{style:{fontWeight:"bold",marginBottom:"8px",fontSize:"15px"}},t.layerName),(0,e.jsx)("div",{style:{fontSize:"14px",color:"#666",marginBottom:"8px"}},t.featureCount," feature",1!==t.featureCount?"s":""," found"),t.features.length>0&&t.features.length<=5&&(0,e.jsx)("div",{style:{marginTop:"8px",paddingTop:"8px",borderTop:"1px solid #eee",fontSize:"12px",color:"#666"}},t.features.map(((t,o)=>{var r,s;return(0,e.jsx)("div",{key:o,style:{marginBottom:"4px"}},"Feature ",o+1,": ",(null===(r=t.attributes)||void 0===r?void 0:r.name)||(null===(s=t.attributes)||void 0===s?void 0:s.OBJECTID)||"No name")}))))))):(0,e.jsx)("div",{style:{padding:"20px",textAlign:"center",color:"#666"}},"Select a feature from the notification center to see containing layers")))},this.renderNotificationCenter=()=>{const{badgeCount:o,isDropdownOpen:r,newRequests:s,completedRequests:n,loading:i,error:a}=this.state,l=o>0?"#f03b20":"#FFFFFF";return(0,e.jsx)("div",{ref:this.widgetRef,className:"notification-center-widget",style:{position:"relative"}},a&&(0,e.jsx)("div",{style:{padding:"8px",backgroundColor:"#fee",color:"#c00",fontSize:"12px",marginBottom:"4px",borderRadius:"4px"}},"Error: ",a),(0,e.jsx)("div",{onClick:this.toggleDropdown,style:{backgroundColor:l,color:"#000000",borderRadius:"8px",padding:"8px 16px",cursor:"pointer",display:"inline-block",fontWeight:"bold",fontSize:"16px",minWidth:"40px",textAlign:"center",boxShadow:"0 2px 4px rgba(0,0,0,0.1)"}},o),r&&(0,e.jsx)("div",{style:{position:"absolute",top:"100%",left:0,marginTop:"8px",backgroundColor:"#fff",border:"1px solid #ccc",borderRadius:"4px",boxShadow:"0 4px 8px rgba(0,0,0,0.15)",zIndex:1e3,minWidth:"400px",maxWidth:"90vw",maxHeight:"80vh",overflow:"hidden",display:"flex",flexDirection:"column"}},i&&(0,e.jsx)("div",{style:{padding:"20px",textAlign:"center"}},(0,e.jsx)(t.Loading,null)),!i&&(0,e.jsx)(e.React.Fragment,null,(0,e.jsx)("div",{style:{padding:"12px",borderBottom:"1px solid #eee",fontWeight:"bold"}},"New Drone Photograph Requests"),(0,e.jsx)("div",{style:{maxHeight:"300px",overflowY:"auto"}},0===s.length?(0,e.jsx)("div",{style:{padding:"20px",textAlign:"center",color:"#666"}},"No New Request"):s.map((o=>{const r=o.attributes,s=r.project_name||"N/A",n=r.project_id||"N/A",i=1===(r.reviewed||0)?"#28a745":"#ffc107";return(0,e.jsx)("div",{key:r.objectid,style:{padding:"12px",borderBottom:"1px solid #eee",display:"flex",justifyContent:"space-between",alignItems:"center",cursor:"pointer"},onClick:e=>{"BUTTON"===e.target.tagName||e.target.closest("button")||this.zoomToFeature(o)}},(0,e.jsx)("div",{style:{display:"flex",flexDirection:"column"}},(0,e.jsx)("span",null,s),(0,e.jsx)("span",{style:{fontSize:"0.9em",color:"#666"}},"ID: ",n)),(0,e.jsx)("div",{style:{display:"flex",gap:"8px"}},(0,e.jsx)(t.Button,{onClick:()=>this.handleReviewed(o),style:{backgroundColor:i,color:"#000",border:"none",padding:"6px 12px",borderRadius:"4px",cursor:"pointer"}},"Reviewed"),(0,e.jsx)(t.Button,{onClick:()=>this.handleMoveToComplete(o),style:{backgroundColor:"#007bff",color:"#fff",border:"none",padding:"6px 12px",borderRadius:"4px",cursor:"pointer"}},"Move to Complete")))}))),(0,e.jsx)("div",{style:{padding:"12px",borderTop:"1px solid #eee",borderBottom:"1px solid #eee",fontWeight:"bold",marginTop:"8px"}},"Completed Requests"),(0,e.jsx)("div",{style:{maxHeight:"300px",overflowY:"auto"}},0===n.length?(0,e.jsx)("div",{style:{padding:"20px",textAlign:"center",color:"#666"}},"No New Request"):n.map((o=>{const r=o.attributes,s=r.project_name||"N/A",n=r.project_id||"N/A";return(0,e.jsx)("div",{key:r.objectid,style:{padding:"12px",borderBottom:"1px solid #eee",display:"flex",justifyContent:"space-between",alignItems:"center",cursor:"pointer"},onClick:e=>{"BUTTON"===e.target.tagName||e.target.closest("button")||this.zoomToFeature(o)}},(0,e.jsx)("div",{style:{display:"flex",flexDirection:"column"}},(0,e.jsx)("span",null,s),(0,e.jsx)("span",{style:{fontSize:"0.9em",color:"#666"}},"ID: ",n)),(0,e.jsx)("div",{style:{display:"flex",gap:"8px"}},(0,e.jsx)(t.Button,{onClick:()=>this.handleMoveToOpen(o),style:{backgroundColor:"#6c757d",color:"#fff",border:"none",padding:"6px 12px",borderRadius:"4px",cursor:"pointer"}},"Move to Open Request")))}))))))},this.state={badgeCount:0,isDropdownOpen:!1,newRequests:[],completedRequests:[],loading:!1,error:null,selectedFeature:null,containingLayers:[]},this.widgetRef=e.React.createRef(),this.featureLayerUrl=(null===(s=this.props.config)||void 0===s?void 0:s.featureLayerUrl)||"https://services9.arcgis.com/izXUvkghw2ajVOfV/arcgis/rest/services/service_087bed6088934ce58e9ae3bb55309241/FeatureServer/0"}componentDidMount(){var e;const t=(null===(e=this.props.config)||void 0===e?void 0:e.widgetMode)||"notification";"notification"===t?this.loadData():"layers-panel"===t&&this.subscribeToFeatureSelection()}componentDidUpdate(e,t){this.state.isDropdownOpen&&!t.isDropdownOpen?document.addEventListener("mousedown",this.handleClickOutside):!this.state.isDropdownOpen&&t.isDropdownOpen&&document.removeEventListener("mousedown",this.handleClickOutside)}render(){var e;return"layers-panel"===((null===(e=this.props.config)||void 0===e?void 0:e.widgetMode)||"notification")?this.renderLayersPanel():this.renderNotificationCenter()}}function s(e){n.p=e}})(),i})())}}}));